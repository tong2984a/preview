<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hello, Vegan!</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <link href="css/selectbox.css" rel="stylesheet">
  <link rel="stylesheet" href="css/leaflet.css" />
  <link rel="stylesheet" href="css/slideshow.css" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
  <link rel="stylesheet" href="css/leaflet-search.src.css" />
  <script src="js/leaflet.js" ></script>
  <style>
    #mapid { height: 360px; }
  </style>
</head>
    <body>
        <div class="container">
            <div class="jumbotron">
              <p class="text-center">
                <a href="main.html">
                    <img src="images/i128x128.png" class="img-responsive" style="margin:0 auto;" alt="Responsive image">
                </a>
              </p>
              <h1 class="text-center">Hello World!</h1>
              <p class="text-center">
                A simple hello could lead to wonderful things <small>v1.15.0</small>
              </p>
            </div>

            <!-- <div class="row justify-content-center">
              <div class="col-xs-6" style="width: 40%;">
                <input type="search" id="searchRestaurantInput" class="form-control input-lg" placeholder="Please enter the restaurant name" style="display: none;" onchange="searchRestaurantDemo(this.value, 'search', selected)">
                <h6 id="restSearch"></h6>
                <label id="searchBtn" class="btn btn-success my-2 btn-default btn-block btn-lg" onClick="(function s(){
                  document.getElementById('searchRestaurantInput').style.display = 'block';
                })()">
                  Search My Dish
                </label>
              </div>
            </div> -->

            <div id="filter" class="row justify-content-center">
              <div class="col-xs-12 form-group" >
                <div id="checkboxgroup-container">
                  <fieldset class="checkboxgroup">
                    <p>Filter Cuisine:</p>
                    <div id="selectCuisines">
                    </div>
                  </fieldset>
                </div>
              </div>
              <div class="col-xs-12 form-group" >
                <div id="checkboxgroup-container">
                  <fieldset class="checkboxgroup">
                    <p>Filter Category:</p>
                    <div id="selectCategories">
                    </div>
                  </fieldset>
                </div>
              </div>
              <div class="col-xs-12 form-group" >
                <div id="checkboxgroup-container">
                  <fieldset class="checkboxgroup">
                    <p>Ingredient List:</p>
                    <div id="selectTags">
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>


            <div style="display: none;">
                <button id="gluten_free" onclick="btnClick(this)" class="btn btn-primary">Gluten Free</button>
                <button id="egg_free" onclick="btnClick(this)" class="btn btn-primary">Egg Free</button>
                <button id="dairy_free" onclick="btnClick(this)" class="btn btn-primary">Dairy Free</button>
                <button id="treenut_free" onclick="btnClick(this)" class="btn btn-primary">Treenut Free</button>
                <button id="peanut_free" onclick="btnClick(this)" class="btn btn-primary">Peanut Free</button>
                <button id="soy_free" onclick="btnClick(this)" class="btn btn-primary">Soy Free</button>
                <button id="raw" onclick="btnClick(this)" class="btn btn-primary">Raw</button>
                <button id="vegan" onclick="btnClick(this)" class="btn btn-primary">Vegan</button>
                <button id="buddhist_friendly" onclick="btnClick(this)" class="btn btn-primary">Buddhist Friendly</button>
                <button id="all_natural" onclick="btnClick(this)" class="btn btn-primary">All Natural</button>
                <button id="clear" onclick="clearTag()" class="btn btn-danger">Clear All</button>
            </div>

<div id="mapid"></div>

            <div class="row justify-content-center">
                <a href="main.html">
                  <label id="back"class="btn btn-primary my-2 btn-default btn-block btn-lg" style="cursor: pointer;">Back to Main</label>
                </a>
            </div>
        </div>
    </body>

        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-storage.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-analytics.js"></script>
        <script src="js/JIC.min.js" type="text/javascript"></script>
        <script src="js/jquery-3.5.1.min.js"></script>


        <script>
          var mymap = L.map('mapid');
          L.tileLayer('https://b.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxNativeZoom: 18,
              maxZoom: 20,
              attribution: '&copy; <a target="_blank" rel="noopener" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(mymap);

          var browserGeolocationSuccess = function(position) {
            currentLocation = [position.coords.latitude, position.coords.longitude];
            onLocationFound("You are here.");
          };

          var browserGeolocationFail = function(error) {
            onLocationFound("Refresh to find your location");
          }

          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              browserGeolocationSuccess, browserGeolocationFail,
              {maximumAge: 70000, timeout: 40000, enableHighAccuracy: true});
          } else {
            onLocationFound("Cannot find your location");
          }

          function onMapClick(e) {
            var popup = L.popup();
              popup
                  .setLatLng(e.latlng)
                  .setContent("You clicked the map at " + e.latlng.toString())
                  .openOn(mymap);
          }

          	function onLocationFound(message) {
              mymap.setView(currentLocation, 13);
              var radius = 1;
              circle = L.circle(currentLocation, {
                  color: 'red',
                  fillColor: '#f03',
                  fillOpacity: 0.5,
                  radius: 5
              }).addTo(mymap);
              let p = circle.bindPopup(message).openPopup();
              mymap.on('click', onMapClick);
          	}

            const firebaseConfig = {
                apiKey: "AIzaSyBg34hCq_jGHdj-HNWi2ZjfqhM2YgWq4ek",
                authDomain: "pay-a-vegan.firebaseapp.com",
                databaseURL: "https://pay-a-vegan.firebaseio.com",
                projectId: "pay-a-vegan",
                storageBucket: "pay-a-vegan.appspot.com",
                messagingSenderId: "587888386485",
                appId: "1:587888386485:web:3a81137924d19cbe2439fc",
                measurementId: "G-MGJK6GF9YW"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const storageRef = firebase.storage().ref();
            const storage = firebase.storage();
            initMap();

            //states
            var isGlutenShown = false;
            var isEggShown = false;
            var isDairyShown = false;
            var isTreenutShown = false;
            var isPeanutShown = false;
            var isSoyShown = false;
            var isRawShown = false;
            var isVeganShown = false;
            var isBuddhistFriendlyShown = false;
            var isAllNaturalShown = false;

            //marker list
            var markers = [];
            var showing = [];
            var newShowing = [];
            var selected = [];
            var selectedRegex = [];

            var isSideOpen = false;
            const BreakException = {};

            var map;
            var currentLocation = [22.276, 114.173];
            const mode = "search";

            function stopAnimation(marker) {
                setTimeout(function () {
                    marker.setAnimation(null);
                }, 3000);
            }

            function hideAllMarkers() {
                markers.forEach(item => item.marker.setVisible(false));
            }

            function showAllMarkers() {
                markers.forEach(item => item.marker.setVisible(true));
            }

            function clearTag() {
                clearAll();
                isGlutenShown = false;
                isEggShown = false;
                isDairyShown = false;
                isTreenutShown = false;
                isPeanutShown = false;
                isSoyShown = false;
                isRawShown = false;
                isVeganShown = false;
                isBuddhistFriendlyShown = false;
                isAllNaturalShown = false;

                document.getElementById('gluten_free').style = '';
                document.getElementById('egg_free').style = '';
                document.getElementById('dairy_free').style = '';
                document.getElementById('treenut_free').style = '';
                document.getElementById('peanut_free').style = '';
                document.getElementById('soy_free').style = '';
                document.getElementById('raw').style = '';
                document.getElementById('vegan').style = '';
                document.getElementById('buddhist_friendly').style = '';
                document.getElementById('all_natural').style = '';
            }

            function initMap() {
              console.log('initializing map');
              db.collection('restaurants').get().then((snapshot) => {
                snapshot.docs.forEach(doc => {
                  var restaurantData = doc.data();
                  let marker = addRestMarker(restaurantData, doc.id);
                });
              });
            }

</script>
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <script src="js/mapHelper.js" type="text/javascript"></script>
    <script src="js/leaflet-search.src.js"></script>
</html>
